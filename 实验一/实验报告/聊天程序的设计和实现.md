# 聊天程序的设计和实现

> 朱浩泽 计算机科学与技术 1911530

## 作业说明

利用Socket，设计和编写一个聊天程序。基本要求如下：

1. 设计一个两人聊天协议，要求聊天信息带有时间标签。
2. 对聊天程序进行设计。
3. 在Windows系统下，利用C/C++中的流式Socket对设计的程序进行实现。程序界面可以采用命令行方式，但需要给出使用方法。
4. 对实现的程序进行测试。
5. 撰写实验报告，并将实验报告和源码提交至本网站。

## 应用层协议设计

本次实验传输层协议采用 TCP 协议，数据以流式传输。

应用层设计的双人聊天室为客户端和服务端相互发送并接收信息，要求服务器和客户端同时在线时。客户端可以向服务器发送消息并接受服务器传来的消息，同样服务器也可以向客户端发送消息并接受客户端传输的消息。对于消息来说，每条消息具体报文**长度不能超过100个字符**，并以空格或换行符表示结束，如过超过此长度，超过的部分将被自动忽略；如果一次输入中包含空格，将根据空格拆分成多个字符串分别发送。

关于消息发送和接收的显示：当成功接收到消息时，将在接受到的消息前打上时间戳后显示，如`x日x时x分x秒收到消息:` ；当成功发送消息时，将提示`消息已于x日x时x分x秒成功发送`。如果发送消息`quit()`，则证明用户即将结束聊天，则发送这条消息的端口则会显示`您已于x日x时x分x秒退出聊天室`，接收端收到该条消息后会显示`对方已于x日x时x分x秒下线退出聊天室`，至此聊天结束。

聊天室将采用多线程的方式将接收消息和发送消息分开执行，用户可以随时发送并接收消息。接收到的消息按照时间顺序打印。

## 程序设计

### 项目环境

本实验在Windows10平台上使用C++11进行设计，采用visual studio 2017编译器，利用Windows自带的winsock2接口链接ws2_32.lib库，搭建一个基础的winSock程序实现双人聊天程序的设计。

### 设计思路 

1. 关于服务端

   服务器开启后将对客户端进行监听，当客户端上线后，将在服务端进行提醒。一旦成功连接客户端，则同时可以进行接收和发送的功能，直到收到退出的消息。

2. 关于客户端

   客户端开启后首先尝试连接服务器，如果服务器未开启或连接失败则直接退出程序；若服务器连接成功则同时可以进行接收和发送的功能，直到收到退出的消息。

3. 关于多线程

   在实际的聊天情境中，往往说话顺序并不一定是交替进行，具有不确定性。如果聊天的话语只能交替进行，则用户的使用体验将会非常不佳。所以我们对程序进行多线程设计，使发送消息和接受消息的线程分开，让用户可以随时发送消息，同时不影响消息的接收

### 具体代码实现

